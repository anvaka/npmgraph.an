const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-wXhy9pUh.js","assets/PackageInfo-DTkeywRC.js","assets/index-BveyBTtd.js","assets/index-BwHuJX8E.css"])))=>i.map(i=>d[i]);
var St=Object.defineProperty;var Mt=(l,t,e)=>t in l?St(l,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):l[t]=e;var ft=(l,t,e)=>Mt(l,typeof t!="symbol"?t+"":t,e);import{_ as wt,o as yt,a as Lt,w as Yt,r as R,b as E,c as F,u as ut,i as Xt,m as Pt,d as st,e as Z,f as k,t as V,F as Ct,g as Nt,h as Bt,T as Tt,j as It,k as Dt,s as nt,l as Et}from"./index-BveyBTtd.js";import{S as K,g as zt,b as Rt,a as At,_ as kt,c as Ft,s as Vt}from"./PackageInfo-DTkeywRC.js";class $t{constructor(){this.viewBox={left:-100,top:-100,right:100,bottom:100},this.transform={scale:1,x:0,y:0},this.width=0,this.height=0,this.pixelRatio=typeof window<"u"?window.devicePixelRatio:1,this._visibleBounds={left:0,top:0,right:0,bottom:0},this._visibleBoundsDirty=!0,this._reusableScenePoint={x:0,y:0},this._reusableScreenPoint={x:0,y:0}}setSize(t,e){this.width=t,this.height=e,this._visibleBoundsDirty=!0}setViewBox(t,e,i,s){this.viewBox.left=t,this.viewBox.top=e,this.viewBox.right=i,this.viewBox.bottom=s}setTransform(t,e,i){this.transform.scale=t,this.transform.x=e,this.transform.y=i,this._visibleBoundsDirty=!0}getNodeScreenSize(t){return t*this.transform.scale}screenToScene(t,e){const i=this._reusableScenePoint;return i.x=(t-this.transform.x)/this.transform.scale,i.y=(e-this.transform.y)/this.transform.scale,i}sceneToScreen(t,e){const i=this._reusableScreenPoint;return i.x=t*this.transform.scale+this.transform.x,i.y=e*this.transform.scale+this.transform.y,i}getVisibleBounds(){return this._updateVisibleBounds(),this._visibleBounds}_updateVisibleBounds(){if(this._visibleBoundsDirty){this._visibleBoundsDirty=!1;const t=this.transform.scale,e=this.transform.x,i=this.transform.y;this._visibleBounds.left=(0-e)/t,this._visibleBounds.top=(0-i)/t,this._visibleBounds.right=(this.width-e)/t,this._visibleBounds.bottom=(this.height-i)/t}}isVisible(t,e,i=0){this._updateVisibleBounds();const s=this._visibleBounds;return t+i>=s.left&&t-i<=s.right&&e+i>=s.top&&e-i<=s.bottom}getTransformString(){return`translate(${this.transform.x}, ${this.transform.y}) scale(${this.transform.scale})`}}function Zt(l,t){const{onPanStart:e,onPanMove:i,onPanEnd:s,onZoom:n}=t;let a=!1,o=0,r=0;const h=[];function d(f,v,_,y){f.addEventListener(v,_,y),h.push({target:f,event:v,handler:_,options:y})}function u(f){f.button===0&&(a=!0,o=f.clientX,r=f.clientY,e&&e({x:o,y:r,event:f}),f.preventDefault())}function m(f){if(!a)return;const v=f.clientX-o,_=f.clientY-r;o=f.clientX,r=f.clientY,i&&i({dx:v,dy:_,x:o,y:r,event:f})}function g(f){a&&(a=!1,s&&s({x:f.clientX,y:f.clientY,event:f}))}function p(f){f.preventDefault();let v=f.deltaY;f.deltaMode===1?v*=40:f.deltaMode===2&&(v*=800);const _=1-v*.003,y=l.getBoundingClientRect(),b=f.clientX-y.left,Y=f.clientY-y.top;n&&n({factor:_,x:b,y:Y,event:f})}function c(f){const v=l.getBoundingClientRect(),_=f.clientX-v.left,y=f.clientY-v.top;n&&n({factor:2,x:_,y,event:f})}return d(l,"mousedown",u),d(window,"mousemove",m),d(window,"mouseup",g),d(l,"wheel",p,{passive:!1}),d(l,"dblclick",c),{dispose(){for(const{target:f,event:v,handler:_,options:y}of h)f.removeEventListener(v,_,y);h.length=0}}}class Ot{constructor(t){this.id=t.identifier,this.x=t.clientX,this.y=t.clientY,this.lastX=this.x,this.lastY=this.y}move(t){this.lastX=this.x,this.lastY=this.y,this.x=t.clientX,this.y=t.clientY}}function qt(l,t){const{onPanStart:e,onPanMove:i,onPanEnd:s,onZoom:n}=t;let a=new Map,o=!1,r=0,h=0,d=null;l.addEventListener("touchstart",u,{passive:!1});function u(f){o||(p(),o=!0);for(let v=0;v<f.touches.length;v++){const _=f.touches[v];a.has(_.identifier)||a.set(_.identifier,new Ot(_))}if(f.touches.length===1){const v=f.touches[0];e&&e({x:v.clientX,y:v.clientY,event:f})}f.preventDefault(),f.stopPropagation()}function m(f){const v=Date.now();let _=0,y=0,b=0,Y=0,C=null,L=null;for(let M=0;M<f.touches.length;M++){const S=f.touches[M],P=a.get(S.identifier);P&&(P.move(S),b+=P.x,Y+=P.y,_+=P.x-P.lastX,y+=P.y-P.lastY,C?L||(L=P):C=P)}const N=f.touches.length;if(N===0)return;if(_/=N,y/=N,b/=N,Y/=N,C&&L){h=v;const M=Math.hypot(L.x-C.x,L.y-C.y),S=Math.hypot(L.lastX-C.lastX,L.lastY-C.lastY);if(S>0){const P=M/S,T=l.getBoundingClientRect(),D=b-T.left,A=Y-T.top;n&&n({factor:P,x:D,y:A,event:f})}f.preventDefault(),f.stopPropagation()}const B=v-h;f.touches.length===1&&B>100&&(_!==0||y!==0)&&i&&i({dx:_,dy:y,x:b,y:Y,event:f})}function g(f){const v=Date.now(),_=v-r;r=v;for(let y=0;y<f.changedTouches.length;y++){const b=f.changedTouches[y];a.delete(b.identifier)}if(f.touches.length===0){if(a.clear(),o=!1,c(),f.changedTouches.length===1&&v-h>350){const y=f.changedTouches[0];if(_<350&&d&&Math.hypot(y.clientX-d.clientX,y.clientY-d.clientY)<30){const Y=l.getBoundingClientRect(),C=y.clientX-Y.left,L=y.clientY-Y.top;n&&n({factor:2,x:C,y:L,event:f})}d={clientX:y.clientX,clientY:y.clientY}}s&&s({x:0,y:0,event:f})}}function p(){document.addEventListener("touchmove",m,{passive:!1}),document.addEventListener("touchend",g,{passive:!1}),document.addEventListener("touchcancel",g,{passive:!1})}function c(){document.removeEventListener("touchmove",m,{passive:!1}),document.removeEventListener("touchend",g,{passive:!1}),document.removeEventListener("touchcancel",g,{passive:!1})}return{dispose(){l.removeEventListener("touchstart",u,{passive:!1}),c(),a.clear()}}}function Wt(l={}){const{friction:t=.92,minVelocity:e=.5,onUpdate:i=()=>{}}=l;let s=0,n=0,a=0,o=null,r=!1;const h=[],d=5;function u(p,c){const f=performance.now();for(h.push({dx:p,dy:c,time:f});h.length>d;)h.shift()}function m(){if(h.length<2)return{vx:0,vy:0};let p=0,c=0,f=0;for(let v=1;v<h.length;v++){const _=h[v].time-h[v-1].time;_>0&&(p+=h[v].dx,c+=h[v].dy,f+=_)}return f===0?{vx:0,vy:0}:{vx:p/f*16,vy:c/f*16}}function g(){o=null;const p=performance.now(),c=Math.min(p-a,32);a=p;const f=c/16,v=Math.pow(t,f);if(s*=v,n*=v,Math.sqrt(s*s+n*n)<e){s=0,n=0;return}i(s*f,n*f),o=requestAnimationFrame(g)}return{startTracking(){r=!0,h.length=0,this.stop()},track(p,c){r&&u(p,c)},release(){r=!1;const{vx:p,vy:c}=m();s=p,n=c,h.length=0,Math.sqrt(s*s+n*n)>=e&&(a=performance.now(),o=requestAnimationFrame(g))},stop(){o!==null&&(cancelAnimationFrame(o),o=null),s=0,n=0},isAnimating(){return o!==null},dispose(){this.stop(),h.length=0}}}function Ht(l,t,e={}){const{onTransform:i=()=>{}}=e;let s=e.minZoom||.1,n=e.maxZoom||20,a=null,o=null,r=null,h=null,d=null;function u(c,f){const{x:v,y:_,scale:y}=t.transform;t.setTransform(y,v+c,_+f),i()}function m(c,f,v){const{x:_,y,scale:b}=t.transform;let Y=b*c;if(Y=Math.max(s,Math.min(n,Y)),Y===b)return;const C=Y/b,L=f-(f-_)*C,N=v-(v-y)*C;t.setTransform(Y,L,N),i()}r=Wt({onUpdate(c,f){u(c,f)}});const g={onPanStart(){r.startTracking()},onPanMove({dx:c,dy:f}){u(c,f),r.track(c,f)},onPanEnd(){r.release()},onZoom({factor:c,x:f,y:v}){m(c,f,v)}};a=Zt(l,g),o=qt(l,g);function p(){h!==null&&(cancelAnimationFrame(h),h=null),d&&(d(),d=null)}return{setZoomLimits(c,f){s=c,n=f},getZoom(){return t.transform.scale},setZoom(c,f=!1){if(f){const y=(t.width/2-t.transform.x)/t.transform.scale,b=(t.height/2-t.transform.y)/t.transform.scale;return this.flyTo(y,b,c)}const{width:v,height:_}=t;m(c/t.transform.scale,v/2,_/2)},pan(c,f){u(c,f)},flyTo(c,f,v,_=300){return new Promise(y=>{r.stop(),p(),d=y;const b=t.transform.x,Y=t.transform.y,C=t.transform.scale,L=Math.max(s,Math.min(n,v)),{width:N,height:B}=t,z=N/2-c*L,M=B/2-f*L,S=performance.now();function P(){const D=performance.now()-S,A=Math.min(D/_,1),x=1-Math.pow(1-A,3),w=b+(z-b)*x,I=Y+(M-Y)*x,$=C+(L-C)*x;t.setTransform($,w,I),i(),A<1?h=requestAnimationFrame(P):(h=null,d=null,y())}h=requestAnimationFrame(P)})},stop(){r.stop(),p()},dispose(){p(),a&&(a.dispose(),a=null),o&&(o.dispose(),o=null),r&&(r.dispose(),r=null)}}}const _t="http://www.w3.org/2000/svg";function Gt(l,t={}){const{viewBox:e={left:-100,top:-100,right:100,bottom:100},panZoom:i={}}=t,s=document.createElementNS(_t,"svg");s.style.position="relative",s.style.width="100%",s.style.height="100%",s.style.display="block",s.style.overflow="hidden",l.appendChild(s);const n=document.createElementNS(_t,"g");n.setAttribute("class","scene-transform"),s.appendChild(n);const a=new $t;a.setViewBox(e.left,e.top,e.right,e.bottom);const o=[],r={render:[],transform:[],resize:[]};let h=null,d=!0;function u(){const _=l.getBoundingClientRect();a.setSize(_.width,_.height);const y=e.right-e.left,b=e.bottom-e.top,Y=_.width/y,C=_.height/b,L=Math.min(Y,C),N=_.width/2,B=_.height/2,z=(e.left+e.right)/2,M=(e.top+e.bottom)/2;a.setTransform(L,N-z*L,B-M*L),m("resize",{width:_.width,height:_.height}),p()}function m(_,y){const b=r[_];if(b)for(let Y=0;Y<b.length;Y++)b[Y](y)}function g(){if(h=null,!!d){d=!1,n.setAttribute("transform",a.getTransformString());for(let _=0;_<o.length;_++)o[_].render(a);m("render",a)}}function p(){d=!0,h===null&&(h=requestAnimationFrame(g))}let c=null;i.enabled!==!1&&(c=Ht(s,a,{minZoom:i.minZoom||.1,maxZoom:i.maxZoom||20,onTransform:()=>{m("transform",a.transform),p()}}));const f=new ResizeObserver(()=>{u()});f.observe(l),u();const v={svg:s,root:n,drawContext:a,addCollection(_){o.push(_);const y=_.getRoot();return y&&n.appendChild(y),p(),_},removeCollection(_){const y=o.indexOf(_);if(y!==-1){o.splice(y,1);const b=_.getRoot();b&&b.parentNode&&b.parentNode.removeChild(b),p()}},requestRender:p,on(_,y){return r[_]&&r[_].push(y),v},off(_,y){if(r[_]){const b=r[_].indexOf(y);b!==-1&&r[_].splice(b,1)}return v},getPanZoom(){return c},flyTo(_,y,b,Y=300){return c?c.flyTo(_,y,b,Y):Promise.resolve()},fitToView(_,y=20){const{width:b,height:Y}=a,C=_.right-_.left,L=_.bottom-_.top,N=(b-y*2)/C,B=(Y-y*2)/L,z=Math.min(N,B),M=(_.left+_.right)/2,S=(_.top+_.bottom)/2;return this.flyTo(M,S,z)},dispose(){h!==null&&(cancelAnimationFrame(h),h=null),f.disconnect(),c&&(c.dispose(),c=null);for(let _=0;_<o.length;_++)o[_].dispose&&o[_].dispose();o.length=0;for(const _ in r)r[_].length=0;s.parentNode&&s.parentNode.removeChild(s)}};return v}function Ut(l,t,e,i,s){xt(l,t,e||0,i||l.length-1,s||Kt)}function xt(l,t,e,i,s){for(;i>e;){if(i-e>600){var n=i-e+1,a=t-e+1,o=Math.log(n),r=.5*Math.exp(2*o/3),h=.5*Math.sqrt(o*r*(n-r)/n)*(a-n/2<0?-1:1),d=Math.max(e,Math.floor(t-a*r/n+h)),u=Math.min(i,Math.floor(t+(n-a)*r/n+h));xt(l,t,d,u,s)}var m=l[t],g=e,p=i;for(W(l,e,t),s(l[i],m)>0&&W(l,e,i);g<p;){for(W(l,g,p),g++,p--;s(l[g],m)<0;)g++;for(;s(l[p],m)>0;)p--}s(l[e],m)===0?W(l,e,p):(p++,W(l,p,i)),p<=t&&(e=p+1),t<=p&&(i=p-1)}}function W(l,t,e){var i=l[t];l[t]=l[e],l[e]=i}function Kt(l,t){return l<t?-1:l>t?1:0}class dt{constructor(t=9){this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(t){let e=this.data;const i=[];if(!J(t,e))return i;const s=this.toBBox,n=[];for(;e;){for(let a=0;a<e.children.length;a++){const o=e.children[a],r=e.leaf?s(o):o;J(t,r)&&(e.leaf?i.push(o):at(t,r)?this._all(o,i):n.push(o))}e=n.pop()}return i}collides(t){let e=this.data;if(!J(t,e))return!1;const i=[];for(;e;){for(let s=0;s<e.children.length;s++){const n=e.children[s],a=e.leaf?this.toBBox(n):n;if(J(t,a)){if(e.leaf||at(t,a))return!0;i.push(n)}}e=i.pop()}return!1}load(t){if(!(t&&t.length))return this;if(t.length<this._minEntries){for(let i=0;i<t.length;i++)this.insert(t[i]);return this}let e=this._build(t.slice(),0,t.length-1,0);if(!this.data.children.length)this.data=e;else if(this.data.height===e.height)this._splitRoot(this.data,e);else{if(this.data.height<e.height){const i=this.data;this.data=e,e=i}this._insert(e,this.data.height-e.height-1,!0)}return this}insert(t){return t&&this._insert(t,this.data.height-1),this}clear(){return this.data=q([]),this}remove(t,e){if(!t)return this;let i=this.data;const s=this.toBBox(t),n=[],a=[];let o,r,h;for(;i||n.length;){if(i||(i=n.pop(),r=n[n.length-1],o=a.pop(),h=!0),i.leaf){const d=Qt(t,i.children,e);if(d!==-1)return i.children.splice(d,1),n.push(i),this._condense(n),this}!h&&!i.leaf&&at(i,s)?(n.push(i),a.push(o),o=0,r=i,i=i.children[0]):r?(o++,i=r.children[o],h=!1):i=null}return this}toBBox(t){return t}compareMinX(t,e){return t.minX-e.minX}compareMinY(t,e){return t.minY-e.minY}toJSON(){return this.data}fromJSON(t){return this.data=t,this}_all(t,e){const i=[];for(;t;)t.leaf?e.push(...t.children):i.push(...t.children),t=i.pop();return e}_build(t,e,i,s){const n=i-e+1;let a=this._maxEntries,o;if(n<=a)return o=q(t.slice(e,i+1)),O(o,this.toBBox),o;s||(s=Math.ceil(Math.log(n)/Math.log(a)),a=Math.ceil(n/Math.pow(a,s-1))),o=q([]),o.leaf=!1,o.height=s;const r=Math.ceil(n/a),h=r*Math.ceil(Math.sqrt(a));mt(t,e,i,h,this.compareMinX);for(let d=e;d<=i;d+=h){const u=Math.min(d+h-1,i);mt(t,d,u,r,this.compareMinY);for(let m=d;m<=u;m+=r){const g=Math.min(m+r-1,u);o.children.push(this._build(t,m,g,s-1))}}return O(o,this.toBBox),o}_chooseSubtree(t,e,i,s){for(;s.push(e),!(e.leaf||s.length-1===i);){let n=1/0,a=1/0,o;for(let r=0;r<e.children.length;r++){const h=e.children[r],d=ot(h),u=te(t,h)-d;u<a?(a=u,n=d<n?d:n,o=h):u===a&&d<n&&(n=d,o=h)}e=o||e.children[0]}return e}_insert(t,e,i){const s=i?t:this.toBBox(t),n=[],a=this._chooseSubtree(s,this.data,e,n);for(a.children.push(t),U(a,s);e>=0&&n[e].children.length>this._maxEntries;)this._split(n,e),e--;this._adjustParentBBoxes(s,n,e)}_split(t,e){const i=t[e],s=i.children.length,n=this._minEntries;this._chooseSplitAxis(i,n,s);const a=this._chooseSplitIndex(i,n,s),o=q(i.children.splice(a,i.children.length-a));o.height=i.height,o.leaf=i.leaf,O(i,this.toBBox),O(o,this.toBBox),e?t[e-1].children.push(o):this._splitRoot(i,o)}_splitRoot(t,e){this.data=q([t,e]),this.data.height=t.height+1,this.data.leaf=!1,O(this.data,this.toBBox)}_chooseSplitIndex(t,e,i){let s,n=1/0,a=1/0;for(let o=e;o<=i-e;o++){const r=G(t,0,o,this.toBBox),h=G(t,o,i,this.toBBox),d=ee(r,h),u=ot(r)+ot(h);d<n?(n=d,s=o,a=u<a?u:a):d===n&&u<a&&(a=u,s=o)}return s||i-e}_chooseSplitAxis(t,e,i){const s=t.leaf?this.compareMinX:Jt,n=t.leaf?this.compareMinY:jt,a=this._allDistMargin(t,e,i,s),o=this._allDistMargin(t,e,i,n);a<o&&t.children.sort(s)}_allDistMargin(t,e,i,s){t.children.sort(s);const n=this.toBBox,a=G(t,0,e,n),o=G(t,i-e,i,n);let r=Q(a)+Q(o);for(let h=e;h<i-e;h++){const d=t.children[h];U(a,t.leaf?n(d):d),r+=Q(a)}for(let h=i-e-1;h>=e;h--){const d=t.children[h];U(o,t.leaf?n(d):d),r+=Q(o)}return r}_adjustParentBBoxes(t,e,i){for(let s=i;s>=0;s--)U(e[s],t)}_condense(t){for(let e=t.length-1,i;e>=0;e--)t[e].children.length===0?e>0?(i=t[e-1].children,i.splice(i.indexOf(t[e]),1)):this.clear():O(t[e],this.toBBox)}}function Qt(l,t,e){if(!e)return t.indexOf(l);for(let i=0;i<t.length;i++)if(e(l,t[i]))return i;return-1}function O(l,t){G(l,0,l.children.length,t,l)}function G(l,t,e,i,s){s||(s=q(null)),s.minX=1/0,s.minY=1/0,s.maxX=-1/0,s.maxY=-1/0;for(let n=t;n<e;n++){const a=l.children[n];U(s,l.leaf?i(a):a)}return s}function U(l,t){return l.minX=Math.min(l.minX,t.minX),l.minY=Math.min(l.minY,t.minY),l.maxX=Math.max(l.maxX,t.maxX),l.maxY=Math.max(l.maxY,t.maxY),l}function Jt(l,t){return l.minX-t.minX}function jt(l,t){return l.minY-t.minY}function ot(l){return(l.maxX-l.minX)*(l.maxY-l.minY)}function Q(l){return l.maxX-l.minX+(l.maxY-l.minY)}function te(l,t){return(Math.max(t.maxX,l.maxX)-Math.min(t.minX,l.minX))*(Math.max(t.maxY,l.maxY)-Math.min(t.minY,l.minY))}function ee(l,t){const e=Math.max(l.minX,t.minX),i=Math.max(l.minY,t.minY),s=Math.min(l.maxX,t.maxX),n=Math.min(l.maxY,t.maxY);return Math.max(0,s-e)*Math.max(0,n-i)}function at(l,t){return l.minX<=t.minX&&l.minY<=t.minY&&t.maxX<=l.maxX&&t.maxY<=l.maxY}function J(l,t){return t.minX<=l.maxX&&t.minY<=l.maxY&&t.maxX>=l.minX&&t.maxY>=l.minY}function q(l){return{children:l,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function mt(l,t,e,i,s){const n=[t,e];for(;n.length;){if(e=n.pop(),t=n.pop(),e-t<=i)continue;const a=t+Math.ceil((e-t)/i/2)*i;Ut(l,a,t,e,s),n.push(t,a,a,e)}}const pt="http://www.w3.org/2000/svg";function X(l,t,e){return typeof l=="function"?l(t,e):l}function rt(l){return l?String(l).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"):""}function ie(l){if(l.type&&!l.layers){const{minZoom:t,maxZoom:e,importance:i,hitArea:s,...n}=l;return{minZoom:t||0,maxZoom:e,importance:i,hitArea:s,layers:[n]}}return{minZoom:l.minZoom||0,maxZoom:l.maxZoom,importance:l.importance,hitArea:l.hitArea,layers:l.layers||[]}}function se(l,t,e){if(l.visible!==void 0&&!X(l.visible,t,e))return"";const i=l.type;if(i==="circle"){const s=X(l.radius,t,e)||4,n=X(l.fill,t,e)||"none",a=X(l.stroke,t,e)||"none",o=X(l.strokeWidth,t,e)||0,r=X(l.opacity,t,e),h=X(l.filter,t,e);let d=`r="${s}" fill="${n}"`;return a!=="none"&&(d+=` stroke="${a}"`),o&&(d+=` stroke-width="${o}"`),r!=null&&(d+=` opacity="${r}"`),h&&(d+=` filter="${h}"`),`<circle ${d}/>`}if(i==="rect"){const s=X(l.width,t,e)||10,n=X(l.height,t,e)||10,a=X(l.rx,t,e),o=X(l.ry,t,e),r=X(l.fill,t,e)||"none",h=X(l.stroke,t,e)||"none",d=X(l.strokeWidth,t,e)||0,u=X(l.opacity,t,e),m=X(l.filter,t,e);let g=`x="${-s/2}" y="${-n/2}" width="${s}" height="${n}" fill="${r}"`;return a!=null&&(g+=` rx="${a}"`),o!=null&&(g+=` ry="${o}"`),h!=="none"&&(g+=` stroke="${h}"`),d&&(g+=` stroke-width="${d}"`),u!=null&&(g+=` opacity="${u}"`),m&&(g+=` filter="${m}"`),`<rect ${g}/>`}if(i==="text"){const s=X(l.text,t,e);if(s==null||s==="")return"";const n=X(l.fontSize,t,e)||10,a=X(l.fill,t,e)||"#000",o=X(l.fontFamily,t,e),r=X(l.fontWeight,t,e),h=X(l.anchor,t,e)||"center",d=X(l.offset,t,e)||[0,0],u=X(l.opacity,t,e),m=X(l.maxWidth,t,e);let g="middle",p=d[0],c=d[1];h==="center"&&(c+=n*.35);let f=`x="${p}" y="${c}" text-anchor="${g}" font-size="${n}" fill="${a}"`;o&&(f+=` font-family="${o}"`),r&&(f+=` font-weight="${r}"`),u!=null&&(f+=` opacity="${u}"`);const v=String(s);if(m&&v.length*n*.6>m){const _=bt(v,n,m),y=n*1.3;let b="";for(let Y=0;Y<_.length;Y++)Y===0?b+=`<tspan x="${p}">${rt(_[Y])}</tspan>`:b+=`<tspan x="${p}" dy="${y}">${rt(_[Y])}</tspan>`;return`<text ${f}>${b}</text>`}return`<text ${f}>${rt(v)}</text>`}return i==="render"&&typeof l.render=="function"&&l.render(t,e)||""}function bt(l,t,e){const i=t*.6,s=Math.max(1,Math.floor(e/i)),n=l.split(/\s+/),a=[];let o="";for(let r=0;r<n.length;r++){const h=n[r],d=o?o+" "+h:h;d.length>s&&o?(a.push(o),o=h):o=d}return o&&a.push(o),a}function j(l,t,e){const i=l.layers;if(!i||i.length===0)return"";let s="";for(let n=0;n<i.length;n++)s+=se(i[n],t,e);return s}function lt(l,t,e){const i=l.layers;let s=0,n=0;for(let a=0;a<i.length;a++){const o=i[a];if(o.visible!==void 0&&!X(o.visible,t,e))continue;const r=o.type;if(r==="circle"){const d=(X(o.radius,t,e)||4)*2;d>s&&(s=d),d>n&&(n=d)}else if(r==="rect"){const h=X(o.width,t,e)||10,d=X(o.height,t,e)||10;h>s&&(s=h),d>n&&(n=d)}else if(r==="text"){const h=X(o.text,t,e);if(!h)continue;const d=X(o.fontSize,t,e)||10,u=X(o.offset,t,e)||[0,0],m=X(o.maxWidth,t,e),g=String(h);let p,c;if(m&&g.length*d*.6>m){const f=bt(g,d,m);p=m+Math.abs(u[0])*2,c=f.length*d*1.3+Math.abs(u[1])}else p=g.length*d*.6+Math.abs(u[0])*2,c=d+Math.abs(u[1]);p>s&&(s=p),n+=c}}if(l.hitArea){const a=l.hitArea;a.type==="rect"&&(s=X(a.width,t,e)||s,n=X(a.height,t,e)||n)}return{width:s,height:n}}function ne(l,t,e){const i=l.layers;for(let s=0;s<i.length;s++){const n=i[s];if(n.type==="circle")return{type:"circle",radius:X(n.radius,t,e)||4};if(n.type==="rect")return{type:"rect",width:X(n.width,t,e)||10,height:X(n.height,t,e)||10}}return null}class oe{constructor(t={}){ft(this,"_transitionRafId",null);this._dataFn=t.data||null,this._maxScale=t.maxScale??1,this._levels=(t.levels||[]).map(ie),this._collisionTrees=new Map,this._spatialIndex=new dt,this._spatialValid=!1,this._positionsDirty=!0,this._attachedNodes=new Set,this._swapAttachedSet=new Set,this._maxNodeSize=0,this._root=document.createElementNS(pt,"g"),this._root.setAttribute("class","node-collection"),this._nodes=[],this._nodeMap=new Map,this._freeIndices=[],this._batchDepth=0,this._batchDirty=!1,this._elementPool=[],this._lastDrawContext=null,this._lastScale=1,this._lastCollisionZoom=0,this._lastCandidateLevel=void 0,this._state=new Map,this._resolvedLevels=new Map,this._prevResolvedLevels=new Map,this._transitions=new Map,this._transitionDuration=150,this._reusableCtx={zoom:1},this._reusableCtxKeys=[],this._collisionInterval=t.collisionInterval??200,this._lastCollisionTime=0,this._collisionNodes=[],this._collisionCandidates=[],this._collisionStable=[],this._graph=t.graph||null,this._graphChangeListener=null,this._graph&&this._dataFn&&this._bindGraph()}getRoot(){return this._root}add(t){const{id:e=this._generateId(),x:i=0,y:s=0,data:n={}}=t,a=this._computeNodeSize(n);let o;this._freeIndices.length>0?o=this._freeIndices.pop():o=this._nodes.length;const r={id:e,index:o,x:i,y:s,size:a,data:n,visible:!0,_element:null,_currentLevel:-1,_inDOM:!1,_collection:this,_stateVersion:0,_renderedLevel:-1,_renderedStateVersion:-1};return this._nodes[o]=r,this._nodeMap.set(e,r),a>this._maxNodeSize&&(this._maxNodeSize=a),this._createNodeElement(r),this._spatialValid=!1,this._batchDepth===0?this._addNodeToScene(r,this._lastDrawContext):this._batchDirty=!0,r}remove(t){const e=typeof t=="object"?t:this._nodeMap.get(t);e&&(e._element&&(e._inDOM&&(this._root.removeChild(e._element),e._inDOM=!1),this._elementPool.push(e._element),e._element=null),this._freeIndices.push(e.index),this._nodes[e.index]=null,this._nodeMap.delete(e.id),this._attachedNodes.delete(e),this._state.delete(e.id),this._resolvedLevels.delete(e.id),this._prevResolvedLevels.delete(e.id),this._transitions.delete(e.id),this._spatialValid=!1,this._batchDepth>0&&(this._batchDirty=!0))}get(t){return this._nodeMap.get(t)}setPosition(t,e,i){t.x=e,t.y=i,this._positionsDirty=!0,this._batchDepth===0&&t._element&&t._inDOM&&this._applyTransform(t)}_applyTransform(t){if(!t._element)return;const e=Math.min(1,this._maxScale/this._lastScale);e!==1?t._element.setAttribute("transform",`translate(${t.x}, ${t.y}) scale(${e})`):t._element.setAttribute("transform",`translate(${t.x}, ${t.y})`)}setState(t,e,i){const s=typeof t=="object"?t.id:t;let n=this._state.get(s);i?(n||(n=new Map,this._state.set(s,n)),n.set(e,!0)):n&&(n.delete(e),n.size===0&&this._state.delete(s));const a=this._nodeMap.get(s);a&&(a._stateVersion++,a._element&&(i?a._element.classList.add(e):a._element.classList.remove(e)))}getState(t,e){const i=typeof t=="object"?t.id:t,s=this._state.get(i);return s&&s.get(e)||!1}invalidateContent(){for(const t of this._nodeMap.values())t._stateVersion++}clearState(t){for(const[e,i]of this._state)if(i.has(t)){i.delete(t),i.size===0&&this._state.delete(e);const s=this._nodeMap.get(e);s&&(s._stateVersion++,s._element&&s._element.classList.remove(t))}}_reapplyState(t){if(!t._element)return;t._element.setAttribute("class","node");const e=this._state.get(t.id);if(e)for(const i of e.keys())t._element.classList.add(i)}_buildCtx(t){const e=this._reusableCtx,i=this._reusableCtxKeys;for(let n=0;n<i.length;n++)e[i[n]]=void 0;i.length=0,e.zoom=this._lastScale;const s=this._state.get(t);if(s)for(const[n,a]of s)e[n]=a,i.push(n);return e}getNodeShape(t){const e=this._nodeMap.get(t);if(!e)return null;const i=this._resolvedLevels.get(t)??0;if(i<0||i>=this._levels.length)return null;const s=this._levels[i],n=this._buildCtx(t),a=ne(s,e.data,n);if(!a)return null;const o=Math.min(1,this._maxScale/this._lastScale);return a.type==="circle"?{type:"circle",radius:a.radius*o,x:e.x,y:e.y}:a.type==="rect"?{type:"rect",width:a.width*o,height:a.height*o,x:e.x,y:e.y}:null}getContentScale(){return Math.min(1,this._maxScale/this._lastScale)}syncPositions(t){this.beginBatch();for(const[e,i]of t){const s=this._nodeMap.get(e);s&&(s.x=i.x,s.y=i.y)}this._positionsDirty=!0,this.endBatch()}getNodeAt(t,e,i){if(i||(i=this._lastDrawContext),!i)return null;const s=i.screenToScene(t,e),n=Math.max(this._maxNodeSize,80/this._lastScale);this._spatialValid||(this._rebuildSpatialIndex(),this._spatialValid=!0);const a=this._spatialIndex.search({minX:s.x-n,minY:s.y-n,maxX:s.x+n,maxY:s.y+n});let o=null,r=1/0;const h=Math.min(1,this._maxScale/this._lastScale),d=10/this._lastScale;for(let u=0;u<a.length;u++){const m=a[u].node,g=s.x-m.x,p=s.y-m.y,c=g*g+p*p;let f=!1;if(this._levels.length>0){const v=this._resolvedLevels.get(m.id)??0;if(v>=0&&v<this._levels.length){const _=this._levels[v],y=this._buildCtx(m.id),b=lt(_,m.data,y),Y=Math.max(b.width*h/2,d),C=Math.max(b.height*h/2,d);f=Math.abs(g)<=Y&&Math.abs(p)<=C}}if(!f){const v=this.getNodeShape(m.id);if(v&&v.type==="circle"){const _=Math.max(v.radius,d);f=c<=_*_}else if(v&&v.type==="rect"){const _=Math.max(v.width/2,d),y=Math.max(v.height/2,d);f=Math.abs(g)<=_&&Math.abs(p)<=y}else{const _=Math.max(d,m.size*.5);f=c<=_*_}}f&&c<r&&(r=c,o=m)}return o?o.id:null}beginBatch(){this._batchDepth++}endBatch(){this._batchDepth>0&&this._batchDepth--,this._batchDepth===0&&this._batchDirty&&(this._batchDirty=!1,this.render(this._lastDrawContext))}forEach(t){for(let e=0;e<this._nodes.length;e++){const i=this._nodes[e];i&&t(i,i.id)}}get count(){return this._nodeMap.size}render(t){if(this._lastDrawContext=t,!t)return;const e=t.transform.scale,i=e!==this._lastScale;this._lastScale=e;const s=performance.now(),n=this._getCandidateLevelIndex(e),a=this._lastCandidateLevel!==void 0&&n!==this._lastCandidateLevel;this._lastCandidateLevel=n;const o=this._lastCollisionZoom>0?e/this._lastCollisionZoom:1/0,r=o>1.2,h=o<.83;a||h||this._positionsDirty&&s-this._lastCollisionTime>=this._collisionInterval?(this._computeResolvedLevels(t,!1),this._lastCollisionTime=s,this._lastCollisionZoom=e):r&&(this._computeResolvedLevels(t,!0),this._lastCollisionTime=s,this._lastCollisionZoom=e),this._positionsDirty?(this._positionsDirty=!1,this._spatialValid=!1,this._renderAllNodes(t,i)):(this._spatialValid||(this._rebuildSpatialIndex(),this._spatialValid=!0),this._renderWithSpatialQuery(t,i))}_computeResolvedLevels(t,e=!1){const i=this._lastScale,s=this._levels;if(s.length===0)return;const n=this._prevResolvedLevels;this._prevResolvedLevels=this._resolvedLevels,this._resolvedLevels=n,this._resolvedLevels.clear();const a=this._getCandidateLevelIndex(i),o=this._collisionNodes;o.length=0;for(let m=0;m<this._nodes.length;m++){const g=this._nodes[m];if(!g||!g.visible)continue;const p=Math.max(g.size,50/i);t.isVisible(g.x,g.y,p)&&o.push(g)}const r=Math.min(1,this._maxScale/i),h=this._collisionCandidates,d=this._collisionStable,u={minX:0,minY:0,maxX:0,maxY:0};for(let m=a;m>=0;m--){const g=s[m];if(i<g.minZoom||g.maxZoom!==void 0&&i>=g.maxZoom)continue;if(!g.importance){for(let c=0;c<o.length;c++){const f=o[c];this._resolvedLevels.has(f.id)||this._resolvedLevels.set(f.id,m)}break}let p=this._collisionTrees.get(m);if(p?p.clear():(p=new dt,this._collisionTrees.set(m,p)),e){d.length=0;for(let c=0;c<o.length;c++){const f=o[c];if(this._resolvedLevels.has(f.id)||this._prevResolvedLevels.get(f.id)!==m)continue;const v=X(g.importance,f.data,this._buildCtx(f.id));d.push(f,v||0)}this._sortPairs(d);for(let c=0;c<d.length;c+=2){const f=d[c];this._fillBbox(u,f,g,r,i,t),p.collides(u)||(p.insert({minX:u.minX,minY:u.minY,maxX:u.maxX,maxY:u.maxY}),this._resolvedLevels.set(f.id,m))}}h.length=0;for(let c=0;c<o.length;c++){const f=o[c];if(this._resolvedLevels.has(f.id))continue;const v=X(g.importance,f.data,this._buildCtx(f.id));h.push(f,v||0)}this._sortPairs(h);for(let c=0;c<h.length;c+=2){const f=h[c];this._fillBbox(u,f,g,r,i,t),p.collides(u)||(p.insert({minX:u.minX,minY:u.minY,maxX:u.maxX,maxY:u.maxY}),this._resolvedLevels.set(f.id,m))}}for(let m=0;m<o.length;m++){const g=o[m];this._resolvedLevels.has(g.id)||this._resolvedLevels.set(g.id,0)}}_getCandidateLevelIndex(t){const e=this._levels;let i=0;for(let s=0;s<e.length;s++)t>=e[s].minZoom&&(e[s].maxZoom===void 0||t<e[s].maxZoom)&&(i=s);return i}_renderAllNodes(t,e){this._attachedNodes.clear();for(let i=0;i<this._nodes.length;i++){const s=this._nodes[i];if(!s||!s._element)continue;const n=Math.max(s.size,50/this._lastScale);t.isVisible(s.x,s.y,n)?(s._inDOM||(this._root.appendChild(s._element),s._inDOM=!0,this._reapplyState(s)),this._applyTransform(s),this._updateNodeContent(s,t,e),this._attachedNodes.add(s)):s._inDOM&&(this._root.removeChild(s._element),s._inDOM=!1)}}_renderWithSpatialQuery(t,e){const i=t.getVisibleBounds(),s=Math.max(this._maxNodeSize,100/this._lastScale),n=this._spatialIndex.search({minX:i.left-s,minY:i.top-s,maxX:i.right+s,maxY:i.bottom+s}),a=this._swapAttachedSet;a.clear();for(let o=0;o<n.length;o++){const r=n[o].node;if(!r._element)continue;const h=Math.max(r.size,50/this._lastScale);t.isVisible(r.x,r.y,h)&&(r._inDOM||(this._root.appendChild(r._element),r._inDOM=!0,this._reapplyState(r),this._applyTransform(r)),this._updateNodeContent(r,t,e),a.add(r))}for(const o of this._attachedNodes)!a.has(o)&&o._inDOM&&(this._root.removeChild(o._element),o._inDOM=!1);this._swapAttachedSet=this._attachedNodes,this._attachedNodes=a}_rebuildSpatialIndex(){const t=[];for(const e of this._nodes)e&&t.push({minX:e.x,minY:e.y,maxX:e.x,maxY:e.y,node:e});this._spatialIndex.clear(),t.length>0&&this._spatialIndex.load(t)}_addNodeToScene(t,e){if(!t._element||!e)return;const i=Math.max(t.size,50/this._lastScale);e.isVisible(t.x,t.y,i)&&(t._inDOM||(this._root.appendChild(t._element),t._inDOM=!0,this._reapplyState(t),this._attachedNodes.add(t)),this._updateNodeContent(t,e))}_updateNodeContent(t,e,i=!1){if(!t._element||!e||(i&&this._applyTransform(t),this._levels.length===0))return;const s=this._resolvedLevels.get(t.id)??0;t._currentLevel!==s&&(t._currentLevel>=0&&this._transitions.set(t.id,{fromLevel:t._currentLevel,toLevel:s,startTime:performance.now()}),t._currentLevel=s),!(!this._transitions.has(t.id)&&t._currentLevel===t._renderedLevel&&t._stateVersion===t._renderedStateVersion)&&(this._renderNode(t),t._renderedLevel=t._currentLevel,t._renderedStateVersion=t._stateVersion)}_renderNode(t){const e=this._levels,i=t._currentLevel;if(i<0||i>=e.length)return;const s=e[i],n=this._buildCtx(t.id),a=this._transitions.get(t.id);if(a){const o=performance.now()-a.startTime,r=Math.min(1,o/this._transitionDuration);if(r>=1){this._transitions.delete(t.id);const h=j(s,t.data,n);t._element.innerHTML=`<g>${h}</g>`}else{const h=e[a.fromLevel],d=e[a.toLevel],u=h?j(h,t.data,n):"",m=d?j(d,t.data,n):"";t._element.innerHTML=`<g opacity="${1-r}">${u}</g><g opacity="${r}">${m}</g>`,this._lastDrawContext&&this._scheduleTransitionFrame();return}}else{const o=j(s,t.data,n);t._element.innerHTML=`<g>${o}</g>`}}_scheduleTransitionFrame(){this._transitionRafId||(this._transitionRafId=requestAnimationFrame(()=>{if(this._transitionRafId=null,this._transitions.size>0)for(const[t]of this._transitions){const e=this._nodeMap.get(t);e&&e._inDOM&&this._renderNode(e)}}))}_fillBbox(t,e,i,s,n,a){const o=this._buildCtx(e.id),r=lt(i,e.data,o),h=a.sceneToScreen(e.x,e.y),d=r.width*s*n/2,u=r.height*s*n/2;t.minX=h.x-d,t.minY=h.y-u,t.maxX=h.x+d,t.maxY=h.y+u}_sortPairs(t){const e=t.length>>1;if(!(e<=1))for(let i=1;i<e;i++){const s=t[i*2],n=t[i*2+1];let a=i-1;for(;a>=0&&t[a*2+1]<n;)t[(a+1)*2]=t[a*2],t[(a+1)*2+1]=t[a*2+1],a--;t[(a+1)*2]=s,t[(a+1)*2+1]=n}}clear(){for(let t=0;t<this._nodes.length;t++){const e=this._nodes[t];e&&this.remove(e)}this._nodes.length=0,this._freeIndices.length=0,this._nodeMap.clear(),this._attachedNodes.clear(),this._swapAttachedSet.clear(),this._spatialIndex.clear(),this._spatialValid=!1,this._maxNodeSize=0,this._state.clear(),this._resolvedLevels.clear(),this._prevResolvedLevels.clear(),this._transitions.clear(),this._collisionTrees.clear(),this._lastCollisionZoom=0,this._lastCandidateLevel=void 0}dispose(){this._graph&&this._graphChangeListener&&(this._graph.off("changed",this._graphChangeListener),this._graphChangeListener=null),this._transitionRafId&&(cancelAnimationFrame(this._transitionRafId),this._transitionRafId=null),this.clear(),this._elementPool.length=0,this._root.parentNode&&this._root.parentNode.removeChild(this._root)}_generateId(){return`node_${Date.now()}_${Math.random().toString(36).slice(2,9)}`}_computeNodeSize(t){const e=this._levels;if(e.length===0)return 10;let i=0;const s={zoom:1};for(let n=0;n<e.length;n++){const a=lt(e[n],t,s),o=Math.max(a.width,a.height);o>i&&(i=o)}return i||10}_createNodeElement(t){let e=this._elementPool.pop();e||(e=document.createElementNS(pt,"g")),e.setAttribute("class","node"),e.innerHTML="",t._element=e}_bindGraph(){const t=this._graph;this.beginBatch(),t.forEachNode(e=>{const i=this._dataFn(e);this.add({id:e.id,data:i})}),this.endBatch(),this._graphChangeListener=e=>{this.beginBatch();for(let i=0;i<e.length;i++){const s=e[i];if(s.node)if(s.changeType==="add"){if(!this._nodeMap.has(s.node.id)){const n=this._dataFn(s.node);this.add({id:s.node.id,data:n})}}else s.changeType==="remove"&&this.remove(s.node.id)}this.endBatch()},t.on("changed",this._graphChangeListener)}}function ae(l,t,e){return{x:l*e,y:t*e}}function re(l,t,e,i){const s=Math.abs(l)||1e-10,n=Math.abs(t)||1e-10,a=e/s,o=i/n,r=Math.min(a,o);return{x:l*r,y:t*r}}function tt(l,t,e){return e.type==="circle"?ae(l,t,e.radius):e.type==="rect"?re(l,t,e.width/2,e.height/2):{x:0,y:0}}function ht(l,t,e){return typeof l=="function"?l(t,e):l}class le{constructor(t={}){this._colorProp=t.color||"#999",this._widthProp=t.width||1,this._opacityProp=t.opacity||.6,this._allLiteralStyles=typeof this._colorProp!="function"&&typeof this._widthProp!="function"&&typeof this._opacityProp!="function",this._directed=t.directed||!1,this._dataFn=t.data||null,this._spatialIndex=new dt,this._spatialValid=!1,this._positionsDirty=!0,this._edges=[],this._edgeMap=new Map,this._freeIndices=[],this._batchDepth=0,this._batchDirty=!1,this._lastDrawContext=null,this._lastScale=-1,this._state=new Map,this._stateVersion=0,this._arrowLength=t.arrowLength||10,this._arrowWidth=t.arrowWidth||5,this._graph=t.graph||null,this._nodeCollection=t.nodeCollection||null,this._graphChangeListener=null,this._cachedDirections=new Map,this._reusableCtx={zoom:1},this._reusableCtxKeys=[],this._batches=new Map,this._batchPool=[],this._container=t.container||null,this._canvas=document.createElement("canvas"),this._canvas.style.position="absolute",this._canvas.style.top="0",this._canvas.style.left="0",this._canvas.style.pointerEvents="none",this._ctx2d=this._canvas.getContext("2d"),this._container&&(getComputedStyle(this._container).position==="static"&&(this._container.style.position="relative"),this._container.insertBefore(this._canvas,this._container.firstChild)),this._root=null,this._canvasWidth=0,this._canvasHeight=0,this._resizeObserver=null,this._container&&typeof ResizeObserver<"u"&&(this._resizeObserver=new ResizeObserver(()=>{this._resizeCanvas(),this._lastDrawContext&&this.render(this._lastDrawContext)}),this._resizeObserver.observe(this._container)),this._graph&&this._bindGraph()}getRoot(){return this._root}add(t){const{id:e=this._generateId(),fromX:i=0,fromY:s=0,toX:n=0,toY:a=0,data:o={}}=t;let r;this._freeIndices.length>0?r=this._freeIndices.pop():r=this._edges.length;const h={id:e,index:r,fromX:i,fromY:s,toX:n,toY:a,data:o,_collection:this};return this._edges[r]=h,this._edgeMap.set(e,h),this._spatialValid=!1,this._batchDepth>0&&(this._batchDirty=!0),h}remove(t){const e=typeof t=="object"?t:this._edgeMap.get(t);e&&(this._freeIndices.push(e.index),this._edges[e.index]=null,this._edgeMap.delete(e.id),this._state.delete(e.id),this._cachedDirections.delete(e.id),this._spatialValid=!1,this._batchDepth>0&&(this._batchDirty=!0))}get(t){return this._edgeMap.get(t)}setEndpoints(t,e,i,s,n){t.fromX=e,t.fromY=i,t.toX=s,t.toY=n,this._positionsDirty=!0}setState(t,e,i){const s=typeof t=="object"?t.id:t;let n=this._state.get(s);i?(n||(n=new Map,this._state.set(s,n)),n.set(e,!0)):n&&(n.delete(e),n.size===0&&this._state.delete(s)),this._stateVersion++}getState(t,e){const i=typeof t=="object"?t.id:t,s=this._state.get(i);return s&&s.get(e)||!1}clearState(t){let e=!1;for(const[i,s]of this._state)s.has(t)&&(s.delete(t),s.size===0&&this._state.delete(i),e=!0);e&&this._stateVersion++}_buildCtx(t){const e=this._reusableCtx,i=this._reusableCtxKeys;for(let n=0;n<i.length;n++)e[i[n]]=void 0;i.length=0,e.zoom=this._lastScale;const s=this._state.get(t);if(s)for(const[n,a]of s)e[n]=a,i.push(n);return e}syncPositions(t){if(!this._graph)return;const e=this._nodeCollection,i=this._directed&&e;this.beginBatch();for(const s of this._edges){if(!s)continue;const n=s.data.fromId,a=s.data.toId;if(!n||!a)continue;const o=t.get(n),r=t.get(a);if(!(!o||!r))if(i){const h=o.x-r.x,d=o.y-r.y,u=Math.sqrt(h*h+d*d);if(u>.001){const m=h/u,g=d/u;let p=this._cachedDirections.get(s.id);p?(p.dirX=m,p.dirY=g):(p={dirX:m,dirY:g},this._cachedDirections.set(s.id,p));const c=e.getNodeShape(a),f=e.getNodeShape(n);if(c){const v=tt(m,g,c);s.toX=c.x+v.x,s.toY=c.y+v.y}else s.toX=r.x,s.toY=r.y;if(f){const v=tt(-m,-g,f);s.fromX=f.x+v.x,s.fromY=f.y+v.y}else s.fromX=o.x,s.fromY=o.y}else s.fromX=o.x,s.fromY=o.y,s.toX=r.x,s.toY=r.y}else s.fromX=o.x,s.fromY=o.y,s.toX=r.x,s.toY=r.y}this._positionsDirty=!0,this.endBatch()}beginBatch(){this._batchDepth++}endBatch(){this._batchDepth>0&&this._batchDepth--,this._batchDepth===0&&this._batchDirty&&(this._batchDirty=!1,this.render(this._lastDrawContext))}forEach(t){for(let e=0;e<this._edges.length;e++){const i=this._edges[e];i&&t(i,i.id)}}get count(){return this._edgeMap.size}render(t){if(this._lastDrawContext=t,!t)return;const e=t.transform.scale,i=this._directed&&e!==this._lastScale;this._lastScale=e,(t.width!==this._canvasWidth||t.height!==this._canvasHeight)&&this._resizeCanvas(),i&&this._nodeCollection&&this._recomputeArrowOffsets(),this._positionsDirty?(this._positionsDirty=!1,this._spatialValid=!1,this._drawAllEdges(t)):(this._spatialValid||(this._rebuildSpatialIndex(),this._spatialValid=!0),this._drawWithSpatialQuery(t))}_resizeCanvas(){const t=this._lastDrawContext;let e,i;if(t)e=t.width,i=t.height;else if(this._container){const n=this._container.getBoundingClientRect();e=n.width,i=n.height}else return;const s=window.devicePixelRatio||1;this._canvas.width=e*s,this._canvas.height=i*s,this._canvas.style.width=e+"px",this._canvas.style.height=i+"px",this._canvasWidth=e,this._canvasHeight=i}_drawAllEdges(t){const e=this._ctx2d,i=window.devicePixelRatio||1;if(e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,this._canvas.width,this._canvas.height),e.setTransform(i,0,0,i,0,0),this._edgeMap.size===0)return;const s=t.transform.scale,n=t.transform.x,a=t.transform.y,o=t.getVisibleBounds(),r=o.left,h=o.right,d=o.top,u=o.bottom,m=this._directed,g=this._edges;if(this._allLiteralStyles&&this._state.size===0){e.strokeStyle=this._colorProp,e.lineWidth=this._widthProp,e.globalAlpha=this._opacityProp,e.beginPath();for(let p=0;p<g.length;p++){const c=g[p];if(!c)continue;const f=c.fromX<c.toX?c.fromX:c.toX,v=c.fromX>c.toX?c.fromX:c.toX,_=c.fromY<c.toY?c.fromY:c.toY,y=c.fromY>c.toY?c.fromY:c.toY;v<r||f>h||y<d||_>u||(e.moveTo(c.fromX*s+n,c.fromY*s+a),e.lineTo(c.toX*s+n,c.toY*s+a))}if(e.stroke(),m){e.fillStyle=this._colorProp;for(let p=0;p<g.length;p++){const c=g[p];if(!c)continue;const f=c.fromX<c.toX?c.fromX:c.toX,v=c.fromX>c.toX?c.fromX:c.toX,_=c.fromY<c.toY?c.fromY:c.toY,y=c.fromY>c.toY?c.fromY:c.toY;v<r||f>h||y<d||_>u||this._drawArrow(e,c.fromX*s+n,c.fromY*s+a,c.toX*s+n,c.toY*s+a,s)}}e.globalAlpha=1;return}for(let p=0;p<g.length;p++){const c=g[p];if(!c)continue;const f=c.fromX<c.toX?c.fromX:c.toX,v=c.fromX>c.toX?c.fromX:c.toX,_=c.fromY<c.toY?c.fromY:c.toY,y=c.fromY>c.toY?c.fromY:c.toY;v<r||f>h||y<d||_>u||this._addToBatch(c)}this._drawBatches(e,s,n,a,m)}_drawWithSpatialQuery(t){const e=this._ctx2d,i=window.devicePixelRatio||1;if(e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,this._canvas.width,this._canvas.height),e.setTransform(i,0,0,i,0,0),this._edgeMap.size===0)return;const s=t.transform.scale,n=t.transform.x,a=t.transform.y,o=t.getVisibleBounds(),r=this._directed,h=this._spatialIndex.search({minX:o.left,minY:o.top,maxX:o.right,maxY:o.bottom});if(h.length!==0){if(this._allLiteralStyles&&this._state.size===0){e.strokeStyle=this._colorProp,e.lineWidth=this._widthProp,e.globalAlpha=this._opacityProp,e.beginPath();for(let d=0;d<h.length;d++){const u=h[d].edge;e.moveTo(u.fromX*s+n,u.fromY*s+a),e.lineTo(u.toX*s+n,u.toY*s+a)}if(e.stroke(),r){e.fillStyle=this._colorProp;for(let d=0;d<h.length;d++){const u=h[d].edge;this._drawArrow(e,u.fromX*s+n,u.fromY*s+a,u.toX*s+n,u.toY*s+a,s)}}e.globalAlpha=1;return}for(let d=0;d<h.length;d++)this._addToBatch(h[d].edge);this._drawBatches(e,s,n,a,r)}}_addToBatch(t){const e=this._buildCtx(t.id),i=ht(this._colorProp,t.data,e),s=ht(this._widthProp,t.data,e),n=ht(this._opacityProp,t.data,e),a=i+"|"+s+"|"+n;let o=this._batches.get(a);o||(o=this._batchPool.pop(),o?(o.color=i,o.width=s,o.opacity=n,o.count=0):o={color:i,width:s,opacity:n,edges:[],count:0},this._batches.set(a,o)),o.count<o.edges.length?o.edges[o.count]=t:o.edges.push(t),o.count++}_drawBatches(t,e,i,s,n){for(const a of this._batches.values()){t.strokeStyle=a.color,t.lineWidth=a.width,t.globalAlpha=a.opacity,t.beginPath();const o=a.edges,r=a.count;for(let h=0;h<r;h++){const d=o[h];t.moveTo(d.fromX*e+i,d.fromY*e+s),t.lineTo(d.toX*e+i,d.toY*e+s)}if(t.stroke(),n){t.fillStyle=a.color;for(let h=0;h<r;h++){const d=o[h];this._drawArrow(t,d.fromX*e+i,d.fromY*e+s,d.toX*e+i,d.toY*e+s,e)}}}t.globalAlpha=1;for(const a of this._batches.values())a.count=0,this._batchPool.push(a);this._batches.clear()}_drawArrow(t,e,i,s,n,a){const o=s-e,r=n-i,h=Math.sqrt(o*o+r*r);if(h<1)return;const d=o/h,u=r/h,m=-u,g=d,p=Math.min(1,a),c=this._arrowLength*p,f=this._arrowWidth/2*p,v=s-d*c,_=n-u*c;t.beginPath(),t.moveTo(s,n),t.lineTo(v+m*f,_+g*f),t.lineTo(v-m*f,_-g*f),t.closePath(),t.fill()}_rebuildSpatialIndex(){const t=[];for(const e of this._edges)e&&t.push({minX:Math.min(e.fromX,e.toX),minY:Math.min(e.fromY,e.toY),maxX:Math.max(e.fromX,e.toX),maxY:Math.max(e.fromY,e.toY),edge:e});this._spatialIndex.clear(),t.length>0&&this._spatialIndex.load(t)}_recomputeArrowOffsets(){const t=this._nodeCollection;if(t){for(const e of this._edges){if(!e)continue;const i=this._cachedDirections.get(e.id);if(!i)continue;const s=e.data.toId,n=e.data.fromId;if(s){const a=t.getNodeShape(s);if(a){const o=tt(i.dirX,i.dirY,a);e.toX=a.x+o.x,e.toY=a.y+o.y}}if(n){const a=t.getNodeShape(n);if(a){const o=tt(-i.dirX,-i.dirY,a);e.fromX=a.x+o.x,e.fromY=a.y+o.y}}}this._positionsDirty=!0,this._spatialValid=!1}}clear(){this._edges.length=0,this._freeIndices.length=0,this._edgeMap.clear(),this._spatialIndex.clear(),this._spatialValid=!1,this._state.clear(),this._cachedDirections.clear()}dispose(){this._graph&&this._graphChangeListener&&(this._graph.off("changed",this._graphChangeListener),this._graphChangeListener=null),this._resizeObserver&&(this._resizeObserver.disconnect(),this._resizeObserver=null),this.clear(),this._batches.clear(),this._batchPool.length=0,this._canvas.parentNode&&this._canvas.parentNode.removeChild(this._canvas)}_generateId(){return`edge_${Date.now()}_${Math.random().toString(36).slice(2,9)}`}_bindGraph(){const t=this._graph;this.beginBatch(),t.forEachLink(e=>{const i=this._dataFn?{fromId:e.fromId,toId:e.toId,...this._dataFn(e)}:{fromId:e.fromId,toId:e.toId};this.add({id:e.id,data:i})}),this.endBatch(),this._graphChangeListener=e=>{this.beginBatch();for(let i=0;i<e.length;i++){const s=e[i];if(s.link)if(s.changeType==="add"){if(!this._edgeMap.has(s.link.id)){const n=this._dataFn?{fromId:s.link.fromId,toId:s.link.toId,...this._dataFn(s.link)}:{fromId:s.link.fromId,toId:s.link.toId};this.add({id:s.link.id,data:n})}}else s.changeType==="remove"&&this.remove(s.link.id)}this.endBatch()},t.on("changed",this._graphChangeListener)}}function he(l){const t=new Map,e=new Map;l.forEachNode(o=>{let r=0;l.forEachLinkedNode(o.id,()=>{r++}),t.set(o.id,r)});let i=[];t.forEach((o,r)=>{o<=1&&i.push(r)});let s=0,n=0;const a=t.size;for(;i.length>0;){const o=[];for(const r of i)e.has(r)||(e.set(r,s),n++,l.forEachLinkedNode(r,h=>{if(e.has(h.id))return;const d=t.get(h.id)-1;t.set(h.id,d),d<=1&&o.push(h.id)}));i=o,i.length>0&&s++}return n<a&&(s=n===0?0:s+1,t.forEach((o,r)=>{e.has(r)||e.set(r,s)})),{layerMap:e,maxLayer:s}}function ce(l,t,e=.3){const i=new Set;l.forEachLink(n=>{const a=t.getNodePosition(n.fromId),o=t.getNodePosition(n.toId);if(!a||!o)return;const r=a.x-o.x,h=a.y-o.y,d=Math.sqrt(r*r+h*h),u=t.getSpring(n.fromId,n.toId);if(!u)return;const m=u.length;if(m<=0)return;Math.abs(d-m)/m>e&&(i.add(n.fromId),i.add(n.toId))});const s=new Set(i);for(const n of i)l.forEachLinkedNode(n,a=>{s.add(a.id)});return s}const gt="CORE_LAYOUT",vt="LAYER_SETTLE",H="STRESS_DETECT",ct="STRESS_REFINE",et="DONE";class de{constructor(t,e={}){this._graph=t,this._options=e,this._layout=null,this._running=!1,this._rafId=null,this._onUpdate=null,this._nodePositions=new Map,this._smoothing=e.smoothing??.15,this._maxSpeed=e.maxSpeed??50,this._lastFrameTime=0,this._energyThreshold=e.energyThreshold??.003,this._onStabilized=e.onStabilized||null,this._stabilized=!1,this._stabilizedFired=!1,this._stableFrameCount=0,this._stableFramesRequired=e.stableFramesRequired??10,this._layeredLayout=e.layeredLayout??!0,this._stressThreshold=e.stressThreshold??.3,this._maxStressIterations=e.maxStressIterations??200,this._phase=null,this._layerMap=null,this._maxLayer=0,this._currentSettleLayer=0,this._stressPassCount=0,this._stressIterCount=0,this._graphChangeListener=null,this._hiddenNodes=new Set,this._initPromise=this._initLayout(e),this._graphGrowthListener=i=>{if(!this._layout)return;let s=!1;for(let n=0;n<i.length;n++)if(i[n].changeType==="add"&&(i[n].node||i[n].link)){s=!0;break}s&&this._stabilized&&!this._running?(this._stabilized=!1,this._stabilizedFired=!1,this._stableFrameCount=0,this.start()):s&&!this._stabilized&&(this._stableFrameCount=0)},this._graph.on("changed",this._graphGrowthListener)}async _initLayout(t){const e=(await wt(async()=>{const{default:u}=await import("./index-wXhy9pUh.js").then(m=>m.i);return{default:u}},__vite__mapDeps([0,1,2,3]))).default,i=this._graph,s=10,n=t.getNodeSize||(u=>{var g;const m=i.getNode(u);return((g=m==null?void 0:m.data)==null?void 0:g.size)||s});this._getNodeSize=n;const a=t.nodePadding??4,o=t.springLength||30,r=u=>{const m=i.getLinks(u),g=m?m.size??m.length??0:0,p=n(u);return 1+g/3+p*.1},h=(u,m)=>{const g=n(u.fromId),p=n(u.toId),c=(g+p)/2+a;m.length=Math.max(o,c)},d={springLength:o,springCoefficient:t.springCoefficient||8e-4,dragCoefficient:t.dragCoefficient||.04,gravity:t.gravity||-2,theta:t.theta||.8,timeStep:t.timeStep||20,...t,nodeMass:t.nodeMass||r,springTransform:t.springTransform||h};return this._layout=e(i,d),this._layout}async getLayout(){return await this._initPromise,this._layout}onUpdate(t){return this._onUpdate=t,this}async start(){if(await this._initPromise,this._running)return;this._running=!0,this._stabilized=!1,this._stabilizedFired=!1,this._stableFrameCount=0,this._lastFrameTime=0,this._layeredLayout&&this._phase===null&&this._initOrchestration();const t=e=>{if(!this._running)return;const i=this._lastFrameTime?e-this._lastFrameTime:16.67;if(this._lastFrameTime=e,this._layout.step(),this._updateSmoothedPositions(i),this._layeredLayout&&this._phase!==null&&this._phase!==et){if(!this._stabilized)if(this._checkPhaseConvergence()){if(this._stableFrameCount++,this._stableFrameCount>=this._stableFramesRequired){const s=this._advancePhase();if(this._stableFrameCount=0,!s){this._stabilized=!0,this._updatePositions(),this._onUpdate&&this._onUpdate(this._nodePositions),this.stop(),this._onStabilized&&!this._stabilizedFired&&(this._stabilizedFired=!0,this._onStabilized());return}}}else this._stableFrameCount=0;this._phase===ct&&(this._stressIterCount++,this._stressIterCount>=this._maxStressIterations&&(this._unpinAll(),this._phase=H,this._stableFrameCount=0))}else if(!this._stabilized&&this._checkConvergence()){if(this._stableFrameCount++,this._stableFrameCount>=this._stableFramesRequired){this._stabilized=!0,this._updatePositions(),this._onUpdate&&this._onUpdate(this._nodePositions),this.stop(),this._onStabilized&&!this._stabilizedFired&&(this._stabilizedFired=!0,this._onStabilized());return}}else this._stabilized||(this._stableFrameCount=0);this._onUpdate&&this._onUpdate(this._nodePositions),this._rafId=requestAnimationFrame(t)};return this._rafId=requestAnimationFrame(t),this}stop(){return this._running=!1,this._rafId!==null&&(cancelAnimationFrame(this._rafId),this._rafId=null),this}async step(){return await this._initPromise,this._layout.step(),this._updatePositions(),this._nodePositions}async stabilize(t=100){await this._initPromise;for(let e=0;e<t&&(this._layout.step(),!this._checkConvergence());e++);return this._updatePositions(),this._nodePositions}async getNodePosition(t){return await this._initPromise,this._layout.getNodePosition(t)}async setNodePosition(t,e,i){await this._initPromise;const s=this._layout.getNodePosition(t);return s.x=e,s.y=i,this}async pinNode(t){await this._initPromise;const e=this._layout.getBody(t);return e&&(e.isPinned=!0),this}async unpinNode(t){await this._initPromise;const e=this._layout.getBody(t);return e&&(e.isPinned=!1),this}isRunning(){return this._running}getPositions(){return this._nodePositions}async getBounds(){await this._initPromise;let t=1/0,e=1/0,i=-1/0,s=-1/0;if(this._graph.forEachNode(o=>{if(this._hiddenNodes.has(o.id))return;const r=this._layout.getNodePosition(o.id);t=Math.min(t,r.x),e=Math.min(e,r.y),i=Math.max(i,r.x),s=Math.max(s,r.y)}),t>i)return{left:-100,top:-100,right:100,bottom:100,width:200,height:200};const n=i-t,a=s-e;if(n<1||a<1){const o=(t+i)/2,r=(e+s)/2;return{left:o-50,top:r-50,right:o+50,bottom:r+50,width:100,height:100}}return{left:t,top:e,right:i,bottom:s,width:n,height:a}}dispose(){this.stop(),this._graphChangeListener&&this._graph&&(this._graph.off("changed",this._graphChangeListener),this._graphChangeListener=null),this._graphGrowthListener&&this._graph&&(this._graph.off("changed",this._graphGrowthListener),this._graphGrowthListener=null),this._layout=null,this._graph=null,this._nodePositions.clear(),this._onUpdate=null}_checkConvergence(){if(!this._layout)return!1;let t=0;return this._graph.forEachNode(e=>{const i=this._layout.getBody(e.id);i&&i.velocity&&(t+=i.velocity.x*i.velocity.x+i.velocity.y*i.velocity.y)}),t<this._energyThreshold}isStabilized(){return this._stabilized}async getEnergy(){await this._initPromise;let t=0;return this._graph.forEachNode(e=>{const i=this._layout.getBody(e.id);i&&i.velocity&&(t+=i.velocity.x*i.velocity.x+i.velocity.y*i.velocity.y)}),t}_initOrchestration(){const{layerMap:t,maxLayer:e}=he(this._graph);this._layerMap=t,this._maxLayer=e,this._stressPassCount=0,this._stressIterCount=0,this._pinAll(),this._hiddenNodes.clear(),this._graph.forEachNode(i=>{if(t.get(i.id)===e){const s=this._layout.getBody(i.id);s&&(s.isPinned=!1)}else this._hiddenNodes.add(i.id),this._nodePositions.delete(i.id)}),e===0?(this._unpinAll(),this._hiddenNodes.clear(),this._phase=H):(this._phase=gt,this._currentSettleLayer=e-1),this._graphChangeListener||(this._graphChangeListener=()=>this._onGraphChanged(),this._graph.on("changed",this._graphChangeListener))}_checkPhaseConvergence(){if(!this._layout)return!1;let t=0;return this._graph.forEachNode(e=>{const i=this._layout.getBody(e.id);if(!(!i||i.isPinned)&&i.velocity){const s=i.velocity.x*i.velocity.x+i.velocity.y*i.velocity.y;s>t&&(t=s)}}),t<this._energyThreshold}_advancePhase(){switch(this._phase){case gt:return this._unpinLayer(this._currentSettleLayer),this._phase=vt,!0;case vt:return this._currentSettleLayer>0?(this._currentSettleLayer--,this._unpinLayer(this._currentSettleLayer),!0):(this._phase=H,this._advancePhase());case H:{if(this._stressPassCount>=3)return this._phase=et,!1;const t=ce(this._graph,this._layout,this._stressThreshold);if(t.size===0)return this._phase=et,!1;this._pinAll();for(const e of t){const i=this._layout.getBody(e);i&&(i.isPinned=!1)}return this._stressPassCount++,this._stressIterCount=0,this._phase=ct,!0}case ct:return this._unpinAll(),this._phase=H,!0;case et:return!1;default:return!1}}_unpinLayer(t){this._graph.forEachNode(e=>{if(this._layerMap.get(e.id)!==t)return;const i=this._layout.getBody(e.id);if(!i)return;let s=null;if(this._graph.forEachLinkedNode(e.id,n=>{if(this._layerMap.get(n.id)>t)return s=this._layout.getNodePosition(n.id),!0}),s||this._graph.forEachLinkedNode(e.id,n=>{if(!this._hiddenNodes.has(n.id))return s=this._layout.getNodePosition(n.id),!0}),s){const n=this._layout.getNodePosition(e.id),a=5;n.x=s.x+(Math.random()-.5)*a,n.y=s.y+(Math.random()-.5)*a}i.velocity&&(i.velocity.x=0,i.velocity.y=0),i.isPinned=!1,this._hiddenNodes.delete(e.id)})}_pinAll(){this._graph.forEachNode(t=>{const e=this._layout.getBody(t.id);e&&(e.isPinned=!0)})}_unpinAll(){this._graph.forEachNode(t=>{const e=this._layout.getBody(t.id);e&&(e.isPinned=!1)})}_onGraphChanged(){if(!(!this._layeredLayout||!this._layout)){for(const t of this._nodePositions.keys())this._graph.getNode(t)||(this._nodePositions.delete(t),this._hiddenNodes.delete(t));this._running&&(this._stabilized=!1,this._stabilizedFired=!1,this._stableFrameCount=0,this._initOrchestration())}}_updateSmoothedPositions(t){const e=this._smoothing>=1?1:1-Math.pow(1-this._smoothing,t/16.67),i=this._maxSpeed;this._graph.forEachNode(s=>{if(this._hiddenNodes.has(s.id))return;const n=this._layout.getNodePosition(s.id),a=this._nodePositions.get(s.id);if(!a){this._nodePositions.set(s.id,{x:n.x,y:n.y});return}let o=(n.x-a.x)*e,r=(n.y-a.y)*e;const h=Math.sqrt(o*o+r*r);if(h>i){const d=i/h;o*=d,r*=d}a.x+=o,a.y+=r})}_updatePositions(){this._graph.forEachNode(t=>{const e=this._layout.getNodePosition(t.id),i=this._nodePositions.get(t.id);i?(i.x=e.x,i.y=e.y):this._nodePositions.set(t.id,{x:e.x,y:e.y})})}}const fe={__name:"GraphViewer",props:{graph:{type:Object,required:!0},rootId:{type:String,required:!0},highlightRequest:{type:Object,default:null}},emits:["node-selected","layout-ready"],setup(l,{expose:t,emit:e}){const i=l,s=e,n=R(null);let a=null,o=null,r=null,h=null,d=new Map,u=1,m=!0,g=null,p=!1;yt(()=>{i.graph&&n.value&&C()}),Lt(()=>{g&&i.graph&&(i.graph.off("changed",g),g=null),h&&(h.dispose(),h=null),a&&(a.dispose(),a=null),o=null,r=null}),Yt(()=>i.highlightRequest,M=>{if(!(!o||!r)){if(o.clearState("highlighted"),o.clearState("dimmed"),r.clearState("highlighted"),r.clearState("dimmed"),!M){a&&a.requestRender();return}M.ids.forEach(function(S){o.setState(S,"highlighted",!0)}),i.graph.forEachNode(function(S){o.getState(S.id,"highlighted")||o.setState(S.id,"dimmed",!0)}),a&&a.requestRender()}});function c(M){var S=String(M).split("@");return S.length===3?"@"+S[1]:S[0]}function f(M){var S=String(M).split("@");return S[S.length-1]}function v(){var M=i.graph;if(!M)return null;var S=i.rootId;if(M.getNode(S))return S;var P=null;return M.forEachNode(function(T){P||c(T.id)===S&&(P=T.id)}),P}function _(){var M=i.graph;if(M){var S=v();if(S){d.clear(),d.set(S,0);var P=[S],T=0;for(u=0;T<P.length;){var D=P[T++],A=d.get(D);M.forEachLinkedNode(D,function(x){if(!d.has(x.id)){var w=A+1;d.set(x.id,w),w>u&&(u=w),P.push(x.id)}})}m=!1,o&&o.invalidateContent()}}}const y=M=>{var S=d.get(M.nodeId);return S===void 0?0:1-S/Math.max(u,1)};function b(M,S){return S.dimmed?"#666":S["vuln-critical"]?K.CRITICAL:S["vuln-high"]?K.HIGH:S["vuln-moderate"]?K.MODERATE:S["vuln-low"]?K.LOW:"#E8E6F0"}function Y(M){o&&(o.clearState("vuln-critical"),o.clearState("vuln-high"),o.clearState("vuln-moderate"),o.clearState("vuln-low"),M.forEach(function(S,P){var T=zt(M,P);T&&o.setState(P,"vuln-"+T.toLowerCase(),!0)}),a&&a.requestRender())}function C(){var M=i.graph;a=Gt(n.value,{viewBox:{left:-500,top:-500,right:500,bottom:500},panZoom:{minZoom:.1,maxZoom:50}}),o=new oe({graph:M,maxScale:2,data:x=>{var w;return{nodeId:x.id,name:c(x.id),version:f(x.id),description:((w=x.data)==null?void 0:w.description)||""}},size:10,levels:[{type:"circle",radius:2,fill:b,opacity:(x,w)=>w.dimmed?.4:1},{importance:y,layers:[{type:"circle",radius:3,fill:b,opacity:(x,w)=>w.dimmed?.4:1},{type:"text",text:x=>x.name,fontSize:x=>{var w=y(x);return 9+w*w*16},fill:b,anchor:"top",offset:[0,-10]}]},{minZoom:2,importance:y,layers:[{type:"circle",radius:4,fill:b,opacity:(x,w)=>w.dimmed?.4:1},{type:"text",text:x=>x.name,fontSize:x=>{var w=y(x);return 10+w*w*18},fill:b,anchor:"top",offset:[0,-12]},{type:"text",text:x=>x.version,fontSize:14,fill:(x,w)=>w.dimmed?"#555":"#A0A0B8",anchor:"bottom",offset:[0,20],visible:x=>!!x.version}]},{minZoom:3.5,importance:y,layers:[{type:"circle",radius:4,fill:b,opacity:(x,w)=>w.dimmed?.4:1},{type:"text",text:x=>x.name,fontSize:x=>{var w=y(x);return 10+w*w*18},fill:b,anchor:"top",offset:[0,-12]},{type:"text",text:x=>x.version,fontSize:14,fill:(x,w)=>w.dimmed?"#555":"#A0A0B8",anchor:"bottom",offset:[0,20],visible:x=>!!x.version},{type:"text",text:x=>x.description,fontSize:12,fill:(x,w)=>w.dimmed?"#555":"#9090A8",maxWidth:180,anchor:"bottom",offset:[0,36],visible:x=>!!x.description}]}]}),r=new le({graph:M,nodeCollection:o,directed:!0,container:n.value,color:(x,w)=>w.highlighted?"#E0DE0F":"#565E72",width:(x,w)=>w.highlighted?2:1,opacity:(x,w)=>w.dimmed?.2:1}),a.addCollection(r),a.addCollection(o),h=new de(M,{springLength:80,springCoefficient:2e-4,gravity:-1.2,dragCoefficient:.02,layeredLayout:!1,onStabilized:()=>{B.value=!1,p||(p=!0,h.getBounds().then(function(x){a&&a.fitToView(x,40)}))}}),g=function(){m=!0},M.on("changed",g),h.onUpdate(x=>{B.value||(B.value=!0),m&&_(),o.syncPositions(x),r.syncPositions(x),a.requestRender()}),h.getLayout().then(function(){s("layout-ready")}),h.start();var S=M.getNode(i.rootId);S?(M.root=S,h.setNodePosition(i.rootId,0,0),h.pinNode(i.rootId)):M.on("changed",A);function P(x,w){var I=a.svg.getBoundingClientRect(),$=o.getNodeAt(x-I.left,w-I.top,a.drawContext);if($){var it=M.getNode($);it&&(s("node-selected",it),N(it))}else L(),s("node-selected",null)}var T=null;a.svg.addEventListener("mousedown",x=>{T={x:x.clientX,y:x.clientY}}),a.svg.addEventListener("click",x=>{if(T){var w=x.clientX-T.x,I=x.clientY-T.y;if(w*w+I*I>25)return}P(x.clientX,x.clientY)});var D=null;a.svg.addEventListener("touchstart",x=>{x.touches.length===1?D={x:x.touches[0].clientX,y:x.touches[0].clientY}:D=null},{passive:!0}),a.svg.addEventListener("touchend",x=>{if(D&&x.changedTouches.length===1){var w=x.changedTouches[0],I=w.clientX-D.x,$=w.clientY-D.y;I*I+$*$<25&&P(w.clientX,w.clientY)}D=null});function A(x){for(var w=0;w<x.length;w++){var I=x[w];if(I.changeType==="add"&&I.node){M.root=I.node,h.setNodePosition(I.node.id,0,0),h.pinNode(I.node.id),M.off("changed",A);break}}}}function L(){!o||!r||(o.clearState("highlighted"),o.clearState("dimmed"),r.clearState("highlighted"),r.clearState("dimmed"),a&&a.requestRender())}function N(M){!o||!r||(o.clearState("highlighted"),o.clearState("dimmed"),r.clearState("highlighted"),r.clearState("dimmed"),o.setState(M.id,"highlighted",!0),i.graph.forEachLinkedNode(M.id,function(S,P){o.setState(S.id,"highlighted",!0),r.setState(P.id,"highlighted",!0)}),i.graph.forEachNode(function(S){o.getState(S.id,"highlighted")||o.setState(S.id,"dimmed",!0)}),i.graph.forEachLink(function(S){r.getState(S.id,"highlighted")||r.setState(S.id,"dimmed",!0)}),a&&a.requestRender())}const B=R(!0);function z(){h&&(h._running?(h.stop(),B.value=!1):(h.start(),B.value=!0))}return t({toggleLayout:z,layoutRunning:B,applyVulnStates:Y}),(M,S)=>(E(),F("div",{ref_key:"container",ref:n,class:"graphView d2d"},null,512))}},ue={class:"full"},_e={key:1,class:"graph-errors"},me={key:0,class:"error-version"},pe={class:"error-message"},ge={key:2,class:"graph-progress"},ve={key:3,class:"graph-progress"},ye={key:1,class:"switchMode d2d"},Me={__name:"Package2dView",setup(l){const t=It(),e=Dt(),i=nt(null),s=R(""),n=R(!0),a=R(0),o=Et([]),r=R(!1),h=nt(null),d=R(null),u=R(null),m=nt(null),g=R(!1),p=R("");var c=null;yt(()=>{if(t.params.pkgId==="~upload"){if(!ut.value){e.replace("/");return}var L=ut.value;s.value=(L.name||"uploaded-project")+"@"+(L.version||"0.0.0"),c=Rt(L,{includeDevDeps:Xt.value},v)}else s.value=t.params.pkgId,c=At(t.params.pkgId,t.params.version,v);i.value=Pt(c.graph)});function f(){if(c){var L=c;c=null,L.start().then(function(){_(L.errors)})}}function v(L){a.value=L}function _(L){r.value=!0,n.value=!1,L&&L.length&&o.push.apply(o,L),d.value&&d.value.onGraphLoaded(i.value),g.value=!0,Vt(i.value,{onProgress:function(N){p.value=N}}).then(function(N){m.value=N,g.value=!1,u.value&&u.value.applyVulnStates(N),d.value&&d.value.onVulnDataLoaded(N)}).catch(function(){g.value=!1,p.value=""})}function y(L){d.value&&d.value.onNodeSelected(L)}function b(L){h.value=L}function Y(){u.value&&u.value.toggleLayout()}function C(){var L=Ft(t.params,!1);e.push(L)}return(L,N)=>{var B,z;return E(),F("div",ue,[i.value?(E(),st(fe,{key:0,ref_key:"graphViewerRef",ref:u,graph:i.value,"root-id":s.value,"highlight-request":h.value,onNodeSelected:y,onLayoutReady:f},null,8,["graph","root-id","highlight-request"])):Z("",!0),(E(),st(Tt,{to:"#sidebar-target"},[i.value?(E(),st(kt,{key:0,ref_key:"packageInfoRef",ref:d,graph:i.value,"show-actions":r.value,"layout-running":((B=u.value)==null?void 0:B.layoutRunning)??!0,"vuln-map":m.value,onHighlightNode:b,onToggleLayout:Y,onSwitchMode:C},null,8,["graph","show-actions","layout-running","vuln-map"])):Z("",!0),o.length?(E(),F("div",_e,[k("h4",null,"Failed to resolve "+V(o.length)+" package"+V(o.length>1?"s":"")+":",1),k("ul",null,[(E(!0),F(Ct,null,Nt(o,(M,S)=>(E(),F("li",{key:S},[k("strong",null,V(M.name),1),M.version?(E(),F("span",me,V(M.version),1)):Z("",!0),k("div",pe,V(M.message),1)]))),128))])])):Z("",!0),n.value?(E(),F("div",ge,[k("h4",null,[N[0]||(N[0]=Bt("Remaining packages: ",-1)),k("span",null,V(a.value),1)])])):Z("",!0),g.value&&p.value?(E(),F("div",ve,[k("h4",null,V(p.value),1)])):Z("",!0)])),r.value?(E(),F("div",ye,[k("button",{class:"btn",type:"button",onClick:Y},V((z=u.value)!=null&&z.layoutRunning?"Stop":"Start")+" layout ",1),k("button",{class:"btn",type:"button",onClick:C},"Show 3D")])):Z("",!0)])}}};export{Me as default};
